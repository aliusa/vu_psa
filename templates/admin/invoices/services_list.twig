{#Failas užkraunamas iš TVS#}

<table class="table table-responsive table-hover table-condensed table-bordered">
    <thead>
        <tr class="table-secondary">
            <th>ID</th>
            <th class="w-50">Paslauga</th>
            <th>{{ "unit_price_vat"|trans }}</th>
            <th>{{ "unit_price"|trans }}</th>
            <th>{{ "amount"|trans }}</th>
            <th>{{ "total_price_vat"|trans }}</th>
            <th>{{ "total_price"|trans }}</th>
            <th>Priskirta</th>
            <th>Aktyvi nuo</th>
            <th>Aktyvi iki</th>
        </tr>
    </thead>
    <tbody>
        {% if field.value.isEmpty() %}
            <tr class="text-center">
                <td colspan="20">Nėra priskirtų paslaugų</td>
            </tr>
        {% else %}
            {% set unit_price_vat = 0 %}
            {% set unit_price = 0 %}
            {% set total_price_vat = 0 %}
            {% set total_price = 0 %}
            {% for users_objects_services in field.value %}
                <tr>
                    <td>{{ users_objects_services.services.id }}</td>
                    <td>
                        <a class="list-group-item" href="/admin?crudAction=detail&crudControllerFqcn=App\Controller\Admin\UsersObjectsServicesCrudController&entityId={{ users_objects_services.id }}">
                            {{ users_objects_services.services.title }}
                        </a>
                    </td>
                    <td>{{ (users_objects_services.getAdjustedUnitPriceVat(field.formattedValue.invoice)/100)|format_currency('EUR') }}</td>
                    <td>{{ (users_objects_services.getAdjustedUnitPrice(field.formattedValue.invoice)/100)|format_currency('EUR') }}</td>
                    <td>{{ users_objects_services.amount }}</td>
                    <td>{{ (users_objects_services.getAdjustedTotalPriceVat(field.formattedValue.invoice)/100)|format_currency('EUR') }}</td>
                    <td>{{ (users_objects_services.getAdjustedTotalPrice(field.formattedValue.invoice)/100)|format_currency('EUR') }}</td>
                    <td class="text-nowrap">{{ users_objects_services.created_at|date('Y-m-d H:i') }}</td>
                    <td class="text-nowrap">
                        {{ users_objects_services.active_from|date('Y-m-d') }}
                        {% if users_objects_services.active_from > field.formattedValue.invoice.period_start %}
                            <br/>
                            <span class="badge text-bg-secondary">NE VISAS MĖN.</span>
                        {% endif %}
                    </td>
                    <td class="text-nowrap {% if users_objects_services.active_to > "now"|date("Y-m-d") %}text-success{% endif %}">
                        {{ users_objects_services.active_to|date('Y-m-d') }}
                        {% if users_objects_services.active_to < field.formattedValue.invoice.period_end %}
                            <br/>
                            <span class="badge text-bg-secondary">NE VISAS MĖN.</span>
                        {% endif %}
                    </td>
                </tr>
                {% set unit_price_vat = unit_price_vat + users_objects_services.getAdjustedUnitPriceVat(field.formattedValue.invoice) %}
                {% set unit_price = unit_price + users_objects_services.getAdjustedUnitPrice(field.formattedValue.invoice) %}
                {% set total_price_vat = total_price_vat + users_objects_services.getAdjustedTotalPriceVat(field.formattedValue.invoice) %}
                {% set total_price = total_price + users_objects_services.getAdjustedTotalPrice(field.formattedValue.invoice) %}
            {% else %}
                <tr class="text-center">
                    <td colspan="20">Nėra priskirtų paslaugų</td>
                </tr>
            {% endfor %}
            <tr class="table-light">
                <th colspan="2"></th>
                <th>{{ (unit_price_vat/100)|format_currency('EUR') }}</th>
                <th>{{ (unit_price/100)|format_currency('EUR') }}</th>
                <th></th>
                <th>{{ (total_price_vat/100)|format_currency('EUR') }}</th>
                <th class="table-primary">{{ (total_price/100)|format_currency('EUR') }}</th>
                <th colspan="3"></th>
            </tr>
        {% endif %}
    </tbody>
</table>
