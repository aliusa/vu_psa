{% extends 'base.twig' %}

{% block title %}Mano sąskaita #{{ invoice.id }}{% endblock %}

{% block body %}
    <div class="mt-4">
        <h2 class="">Sąskaita <span class="text-muted">{{ invoice.getFormattedSeries() }}</span></h2>
    </div>
    <table class="table table-condensed table-bordered">
        <thead>
            <tr>
                <th>Periodas</th>
                <td>{{ invoice.getPeriod() }}</td>
            </tr>
            <tr>
                <th>Išrašyta</th>
                <td>{{ invoice.created_at|date('Y-m-d') }}</td>
            </tr>
            <tr>
                <th>{{ "total"|trans }}</th>
                <td>{{ (invoice.getInvoiceTotal()/100)|format_currency('EUR') }}</td>
            </tr>
            <tr>
                <th>{{ "due_date"|trans }}</th>
                <td>
                    {{ invoice.due_date|date('Y-m-d') }}
                    {% if invoice.isDuePassed() %}
                        <span class="badge text-bg-danger">VĖLUOJAMA</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>SF Numeris</th>
                <td>
                    {{ invoice.getFormattedSeries() }}
                </td>
            </tr>
            <tr>
                <th>{{ "is_paid"|trans }}</th>
                <td>
                    {% if invoice.is_paid %}
                        <span class="text-success">{{ invoice.is_paid|date('Y-m-d H:i') }}</span>
                        {% if invoice.isPayedPassedDue() %}
                            <span class="badge text-bg-warning">Pavėluotai</span>
                        {% endif %}
                    {% else %}
                        <span class="badge text-bg-danger">{{ "no"|trans }}</span>
                        <a href="/payments/pay/{{ invoice.id }}" class="text-primary">Apmokėti</a>
                    {% endif %}
                </td>
            </tr>
        </thead>
    </table>

    <h2 class="mt-4">Paslaugos</h2>
    <table class="table table-condensed table-bordered table-hover">
        <thead>
            <tr class="table-secondary">
                <th class="w-50">Paslauga</th>
                <th>{{ "unit_price"|trans }}</th>
                <th>{{ "unit_adjustments"|trans }}</th>
                <th>{{ "unit_total"|trans }}</th>
                <th>{{ "amount"|trans }}</th>
                <th>Suma be PVM</th>
                <th>Suma su PVM</th>
            </tr>
        </thead>
        <tbody>
        {% set usersObjectsServices = invoice.getInvoiceServices() %}
            {% if usersObjectsServices %}
                {% set sumUnitPrice = 0 %}
                {% set sumUnitPvm = 0 %}
                {% set sumUnitPriceTotal = 0 %}
                {% set sumTotalPriceBePvm = 0 %}
                {% set sumTotalPriceSuPvm = 0 %}
                {% for users_objects_services in usersObjectsServices %}
                    <tr>
                        <td>{{ users_objects_services.services.title }}{% if users_objects_services.isFullPeriod(invoice) == false %}<br/><i class="text-muted">ne visas mėnuo</i>{% endif %}</td>
                        <td>{{ (users_objects_services.unit_price/100)|format_currency('EUR') }}</td>
                        <td>{{ (users_objects_services.unit_adjustments/100)|format_currency('EUR') }}</td>
                        <td>{{ ((users_objects_services.unit_total)/100)|format_currency('EUR') }}</td>
                        <td>{{ users_objects_services.amount }}</td>
                        <td>{{ (users_objects_services.unit_price * users_objects_services.amount/100)|format_currency('EUR') }}</td>
                        <td>{{ (users_objects_services.total_price/100)|format_currency('EUR') }}</td>
                    </tr>
                    {% set sumUnitPrice = sumUnitPrice + users_objects_services.unit_price %}
                    {% set sumUnitPvm = sumUnitPvm + users_objects_services.unit_adjustments %}
                    {% set sumUnitPriceTotal = sumUnitPriceTotal + users_objects_services.unit_total %}
                    {% set sumTotalPriceBePvm = sumTotalPriceBePvm + users_objects_services.unit_price * users_objects_services.amount %}
                    {% set sumTotalPriceSuPvm = sumTotalPriceSuPvm + users_objects_services.total_price %}
                {% endfor %}
                    <tr class="table-light">
                        <th></th>
                        <th>{{ (sumUnitPrice/100)|format_currency('EUR') }}</th>
                        <th>{{ (sumUnitPvm/100)|format_currency('EUR') }}</th>
                        <th>{{ (sumUnitPriceTotal/100)|format_currency('EUR') }}</th>
                        <th></th>
                        <th>{{ (sumTotalPriceBePvm/100)|format_currency('EUR') }}</th>
                        <th>{{ (sumTotalPriceSuPvm/100)|format_currency('EUR') }}</th>
                    </tr>
            {% else %}
                <tr>
                    <td colspan="20">Nėra paslaugų</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
{% endblock %}
